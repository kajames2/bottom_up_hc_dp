#+begin_src plantuml :file hcdp_uml.png
package "Health Care"{
  Harvest ..> HealthState
  NullHarvest --|> Harvest
  FlatHarvest --|> Harvest
  LinearHarvest --|> Harvest
  RetirementHarvest --|> Harvest
  CompositeHarvest --> NullHarvest
  CompositeHarvest o--|> Harvest

  LinearDegeneration --|> Degeneration

  HealthInvestmentStateFactory --> Degeneration
  HealthInvestmentStateFactory --> Harvest
  HealthInvestmentStateFactory --> HealthState
  
  IncreasingDecayConsumption --|> Consumption
  
  LogisticRegeneration --|> Regeneration
  
  PeriodResultFactory --> Consumption
  PeriodResultFactory --> Regeneration
  PeriodResultFactory --> HealthState
  PeriodResultFactory --> Investment
  PeriodResultFactory --> PeriodResult

  PeriodResult --> Investment
  PeriodResult --> HealthState
}

class HealthState {
  + int period
  + int health
  + int cash
  + int total_working_harvest
  + bool IsAlive()
}

class Investment {
  + int health_investment
  + int life_investment
}

class PeriodResult {
  + HealthState state
  + Investment investment
  + double life_enjoyment
}

abstract class Harvest {
  + bool InRange(int period) const
  + int GetHarvest(HealthState state) const
  + int GetWorkingHarvest(HealthState state) const
}

package "DP" {
  DP --> DPTable
  DP --> DPSolver

  DPSolver --> EndogenousIteratorFactory
  DPSolver --> ExogenousStrategy

  EndogenousIteratorFactory ..> EndogenousIterator
}

abstract class DP<T> {
  - shared_ptr<DPTable<T,T>> table_
  - shared_ptr<DPTable<T,V>> table_val_
  - void Train()
  - vector<T> GetSolution(T start_state)
}

abstract class DPTable<T,V> {
  + V& operator[](T)
  + bool IsEndState(T)
  + V& EndStateEvaluation(T)
}

abstract class EndogenousIterator<T> {
  + explicit operator bool() const
  + T const& operator*() const
  + T const* operator->() const
  + virtual DPStateIterator<T>& operator++()

  - bool done_;
  - T state_;
}

abstract class EndogenousIteratorFactory {
  + EndogenousIterator<T> GetIterator(T)
}

package "Health Care DP" {
  HealthDPTable --|> DPTable

  EndogenousPeriodResultIterator --|> EndogenousIterator
  EndogenousPeriodResultIterator ..> PeriodResultFactory  
  EndogenousPeriodResultIteratorFactory --|> EndogenousIteratorFactory
  EndogenousPeriodResultIteratorFactory ..> EndogenousPeriodResultIterator
  
  HealthDPTableIterator --|> DPTableIterator
  HealthDPTableIteratorFactory --|> DPTableIteratorFactory
  HealthDPTableIteratorFactory ..> HealthDPTableIterator
  
  HealthDPSolver --|> DPSolver
  HealthDPSolver o--> EndogenousPeriodResultIteratorFactory
  HealthDPSolver o--> HealthCareExogenousstrategy
  HealthCareExogenousStrategy --|> ExogenousStrategy
  HealthCareExogenousStrategy ..> HealthInvestmentStateFactory
}

class HealthDPTable {
  + V& operator[](int, int, int)
  + bool IsEndState(int, int, int)
  + V& EndStateEvaluation(int, int, int)

  - vector<vector<vector<HealthState>>> table_
}

class EndogenousPeriodResultIterator {

}

class EndogenousPeriodResultIteratorFactory {
  + InvestmentIteratorFactory()
  + InvestmentIterator GetIterator(HealthState)
}

class HealthDPTableIteratorFactory {
  + HealthDPTableIteratorFactory()
  + HealthDPTableIterator GetIterator(HealthDPTable)
}

class HealthDPTableIterator {

}

class HealthDPSolver {
  - InvestmentIteratorFactory
  - NextPeriodStrategy
  - Solve(DP)
}

#+end_src

#+RESULTS:
[[file:hcdp_uml.png]]
